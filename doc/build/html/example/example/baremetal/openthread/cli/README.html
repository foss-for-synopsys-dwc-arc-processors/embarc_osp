

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>OpenThread CLI Example &mdash; embARC OSP Project Documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/style_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="OpenThread NCP Example" href="../ncp/README.html" />
    <link rel="prev" title="OpenThread Diagnostics Module Reference" href="OT_DIAG.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> embARC
          

          
          </a>

          
            
            
              <div class="version">
                2019.06
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../arc/arc.html">ARC Processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../device/device.html">Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../board/board.html">Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../os/os.html">Operating Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../middleware/middleware.html">Middleware Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../lib/library.html">Libraries</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../example.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../../example.html#overview">Overview</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../../example.html">Examples and Demos</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../baremetal_based_example.html">Baremetal examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../freertos/os_based_example.html">OS Based Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../example.html#application-note">Application Note</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../developer/developer_guides.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/faq.html">Usage Guide FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contribute/contribute.html">Contribute to embARC OSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../changelog/changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../bsp/bsp.html">embARC BSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../license/license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">embARC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../example.html">Examples</a> &raquo;</li>
        
          <li><a href="../../../example.html">Examples and Demos</a> &raquo;</li>
        
          <li><a href="../../baremetal_based_example.html">Baremetal examples</a> &raquo;</li>
        
          <li><a href="../README.html">OpenThread Examples</a> &raquo;</li>
        
      <li>OpenThread CLI Example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="openthread-cli-example">
<span id="example-openthread-cli"></span><h1>OpenThread CLI Example<a class="headerlink" href="#openthread-cli-example" title="Permalink to this headline">¶</a></h1>
<p>This application is designed to show how to use the OpenThread Command Line Interface (CLI) example in embARC.</p>
<div class="section" id="hardware-and-software-setup">
<h2>Hardware and Software Setup<a class="headerlink" href="#hardware-and-software-setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="required-hardware">
<h3>Required Hardware<a class="headerlink" href="#required-hardware" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>2 x <cite>&lt;a href=”https://www.synopsys.com/dw/ipdir.php?ds=arc_em_starter_kit” title=”DesignWare ARC EM Starter Kit(EMSK)”&gt;DesignWare ARC EM Starter Kit(EMSK)&lt;/a&gt;</cite>, recommended version 2.3</p></li>
<li><p>2 x &lt;a href=”<a class="reference external" href="http://store.digilentinc.com/pmod-rf2-ieee-802-15-rf-transceiver/">http://store.digilentinc.com/pmod-rf2-ieee-802-15-rf-transceiver/</a>” title=”Digilent Pmod RF2”&gt;Digilent Pmod RF2&lt;/a&gt;`</p></li>
<li><p>1 x SD card</p></li>
</ul>
</div>
<div class="section" id="required-software">
<h3>Required Software<a class="headerlink" href="#required-software" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Metaware or ARC GNU Toolset</p></li>
<li><p>Serial port terminal, such as putty, tera-term or minicom</p></li>
</ul>
</div>
<div class="section" id="hardware-connection">
<h3>Hardware Connection<a class="headerlink" href="#hardware-connection" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Connect PmodRF2 to J6.</p></li>
</ul>
<a class="reference external image-reference" href="doc/screenshots/emsk_connections.jpg"><img alt="emsk_connections" src="../../../../../_images/emsk_connections.jpg" /></a>
<ul class="simple">
<li><p>Configure your hardware with proper core configuration. ARCEM7D on EMSK 2.3 is used as an example in the following document.</p></li>
</ul>
</div>
</div>
<div class="section" id="user-manual">
<h2>User Manual<a class="headerlink" href="#user-manual" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="running-openthread-in-self-boot-mode">
<h2>Running OpenThread in self-boot mode<a class="headerlink" href="#running-openthread-in-self-boot-mode" title="Permalink to this headline">¶</a></h2>
<p>Two EMSKs will be used as two Thread nodes. They are set automatically by OpenThread stack. The following example is to run the OpenThread CLI in the EMSK self-boot mode with using SD card.</p>
<ul class="simple">
<li><p>The Digilent PmodRF2 and the self-made MRF24J40 module are both supported.</p></li>
<li><p>Use AC adapter to ensure a steady power supply.</p></li>
<li><p>Open two Tera Term emulators to connect EMSKs with different COM ports.</p></li>
<li><p>The self-boot mode preparation is included in the following steps.</p></li>
<li><p><strong>make run</strong> is not supported because both EMSK board is v2.3 and it will lead to conflict.</p></li>
</ul>
</div>
<div class="section" id="building-and-running-openthread-example">
<h2>Building and running OpenThread example<a class="headerlink" href="#building-and-running-openthread-example" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Program the secondary bootloader application into onboard SPI Flash.</p>
<ul>
<li><p>Go to <code class="docutils literal notranslate"><span class="pre">\embARC\example\baremetal\bootloader</span></code> in command line.</p></li>
<li><p>Enter <strong>make TOOLCHAIN=gnu BD_VER=23 CUR_CORE=arcem7d bin</strong></p>
<ul class="simple">
<li><p>Select configuration 1 on the EMSK for ARCEM7D by setting all DIP switches to the OFF position.</p></li>
</ul>
</li>
<li><p>Insert the SD card to your PC, and copy the binary file <code class="docutils literal notranslate"><span class="pre">obj_emsk_23/gnu_arcem7d/emsk_bootloader_gnu_arcem7d.bin</span></code> to the SD Card root directory.  Rename it to <code class="docutils literal notranslate"><span class="pre">em7d_2bt.bin</span></code> as the secondary bootloader.</p>
<ul class="simple">
<li><p>The bootloader has been modified in embARC. Please perform the following steps to update the bootloader in the EMSK SPI flash.</p></li>
<li><p>Update the bootloader in both EMSK boards. The other EMSK board should be updated by performing the same steps.</p></li>
</ul>
</li>
<li><p>Connect one EMSK board to the host with USB. Insert the SD Card into the EMSK board SD Card slot.</p>
<ul class="simple">
<li><p>Go to <code class="docutils literal notranslate"><span class="pre">\embARC\example\freertos\net\ntshell</span></code> in command line. Enter <strong>make TOOLCHAIN=gnu BD_VER=23 CUR_CORE=arcem7d</strong>. Once the application builds successfully, enter <strong>make TOOLCHAIN=gnu BD_VER=23 CUR_CORE=arcem7d run</strong> in command line to start NT-Shell.</p></li>
</ul>
</li>
<li><p>Use NT-Shell command <strong>spirw</strong> in the terminal window to write the <code class="docutils literal notranslate"><span class="pre">em7d_2bt.bin</span></code> to SPI flash.</p>
<ul>
<li><p>run <strong>spirw -h</strong> to show help.</p></li>
<li><p>run <strong>spirw -w em7d_2bt.bin 0x17f00000 0x17f00004</strong> to program SPI flash.</p></li>
<li><p>Check the output message to see if it is programmed successfully. The process may take some time. If <code class="docutils literal notranslate"><span class="pre">WF</span> <span class="pre">INIT</span> <span class="pre">FAILED</span></code> and <code class="docutils literal notranslate"><span class="pre">MRF24G</span> <span class="pre">Init</span> <span class="pre">Failed</span></code> is shown in the Tera Term, there is no error since the WiFi module has not been used here.</p>
<a class="reference external image-reference" href="doc/screenshots/spirw_em7d_2bt.jpg"><img alt="spirw_em7d_2bt" src="../../../../../_images/spirw_em7d_2bt.jpg" /></a>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Generate <code class="docutils literal notranslate"><span class="pre">boot.bin</span></code> of the OpenThread CLI example.</p>
<ul class="simple">
<li><p>Go to <code class="docutils literal notranslate"><span class="pre">\embARC\example\baremetal\openthread\cli</span></code> in command line.</p></li>
<li><p>Enter <strong>make TOOLCHAIN=gnu BD_VER=23 CUR_CORE=arcem7d bin</strong>.</p></li>
<li><p>Insert SD Card to PC. Copy the generated binary file <code class="docutils literal notranslate"><span class="pre">obj_emsk_23/gnu_arcem7d/openthread_gnu_arcem7d.bin</span></code> to SD card root. And rename it to <code class="docutils literal notranslate"><span class="pre">boot.bin</span></code>. Note that the secondary bootloader can only identify <code class="docutils literal notranslate"><span class="pre">boot.bin</span></code> in the SD card root.</p></li>
</ul>
</li>
<li><p>Run OpenThread CLI example. Before resetting the EMSK boards, make sure Bit 4 of the onboard DIP switch is ON to enable secondary bootloader to run.</p>
<ul>
<li><p>Insert SD Card back to one EMSK. Press the reset button to reboot it. Wait for loading boot.bin from SD card. The response in the terminal window is shown as below.</p>
<a class="reference external image-reference" href="doc/screenshots/enter_no_emsk.PNG"><img alt="enter_no_emsk" src="../../../../../_images/enter_no_emsk.PNG" /></a>
</li>
<li><p>Get SD card from one EMSK and insert it to the other EMSK. Press the reset button to reboot it. Wait for loading boot.bin from SD card.</p></li>
<li><p>Enter <strong>1</strong> and press Enter button in one Tera Term. Enter <strong>2</strong> and press Enter button in the other one. Enter the number here to generate pseudo random number for OpenThread. Recommend to enter numbers in order, such as <strong>1</strong>, <strong>2</strong> and <strong>3</strong>. Using same number in different nodes may lead error. The number will not be shown directly in the Tera Term until pressing Enter button from the keyboard.</p>
<a class="reference external image-reference" href="doc/screenshots/show_no_emsk.PNG"><img alt="show_no_emsk" src="../../../../../_images/show_no_emsk.PNG" /></a>
</li>
<li><p>Enter the following commands in the two Tera Term windows.</p>
<ul class="simple">
<li><p><strong>panid 0x1234</strong></p></li>
<li><p><strong>ifconfig up</strong></p></li>
<li><p><strong>thread start</strong></p></li>
</ul>
</li>
<li><p>Wait 20 seconds for completing Thread configuration. Enter “state” to see the state of the node, one leader and one router.</p>
<a class="reference external image-reference" href="doc/screenshots/thread_state.PNG"><img alt="thread_state" src="../../../../../_images/thread_state.PNG" /></a>
</li>
</ul>
</li>
<li><p>Enter <strong>ipaddr</strong> to show the IP address of the Thread node. Then enter <strong>ping [IP address]</strong>, such as <strong>ping fdde:ad00:beef:0:0:ff:fe00:ec00</strong>.</p>
<ul>
<li><p>The IP addresses may not be the same in different tests, even using the same node number, program and EMSK board.</p></li>
<li><p>ICMP protocol is implemented in OpenThread for <strong>ping</strong> command.</p></li>
<li><p>This example demonstrates a minimal OpenThread application to show the OpenThread configuration and management interfaces via a basic command-line interface. The example result is the same as the one in the Posix simulation in Linux.</p></li>
<li><p>See the OpenThread CLI reference <code class="docutils literal notranslate"><span class="pre">OT_CLI.md</span></code> for more details.</p></li>
<li><p>For example, the following response can be shown for the EMSK node 1 (COM4) and EMSK node 2 (COM8).</p>
<a class="reference external image-reference" href="doc/screenshots/thread_ping.PNG"><img alt="thread_ping" src="../../../../../_images/thread_ping.PNG" /></a>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; state
leader
&gt; ipaddr
fdde:ad00:beef:0:0:ff:fe00:fc00
fdde:ad00:beef:0:0:ff:fe00:d400
fdde:ad00:beef:0:63a8:7376:c6ad:828c
fe80:0:0:0:c8b:9427:900e:186f
&gt; ping fe80:0:0:0:f065:44eb:ef9f:57c8
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; state
router
&gt; ipaddr
fdde:ad00:beef:0:0:ff:fe00:fc00
fdde:ad00:beef:0:0:ff:fe00:6800
fdde:ad00:beef:0:4f6e:7e53:67c8:f5b0
fe80:0:0:0:f065:44eb:ef9f:57c8
&gt; ping fe80:0:0:0:c8b:9427:900e:186f
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Synopsys
      <span class="lastupdated">
        Last updated on Aug 04, 2021.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>