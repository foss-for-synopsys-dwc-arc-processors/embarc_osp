

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>OpenThread NCP Example &mdash; embARC OSP Project Documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/style_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="SecureShield Examples" href="../../secureshield/README.html" />
    <link rel="prev" title="OpenThread CLI Example" href="../cli/README.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> embARC
          

          
          </a>

          
            
            
              <div class="version">
                2019.06
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../introduction/introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../arc/arc.html">ARC Processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../device/device.html">Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../board/board.html">Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../os/os.html">Operating Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../middleware/middleware.html">Middleware Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../lib/library.html">Libraries</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../example.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../../example.html#overview">Overview</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../../example.html">Examples and Demos</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../baremetal_based_example.html">Baremetal examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../freertos/os_based_example.html">OS Based Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../example.html#application-note">Application Note</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../developer/developer_guides.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../faq/faq.html">Usage Guide FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../contribute/contribute.html">Contribute to embARC OSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../changelog/changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../bsp/bsp.html">embARC BSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../license/license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">embARC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../example.html">Examples</a> &raquo;</li>
        
          <li><a href="../../../example.html">Examples and Demos</a> &raquo;</li>
        
          <li><a href="../../baremetal_based_example.html">Baremetal examples</a> &raquo;</li>
        
          <li><a href="../README.html">OpenThread Examples</a> &raquo;</li>
        
      <li>OpenThread NCP Example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="openthread-ncp-example">
<span id="example-openthread-ncp"></span><h1>OpenThread NCP Example<a class="headerlink" href="#openthread-ncp-example" title="Permalink to this headline">¶</a></h1>
<p>This application is designed to show how to use the OpenThread Network Co-Processor (NCP) example in embARC. It can serve as a low-power wireless Network Co-Processor (NCP) to communicate with Userspace WPAN Network Daemon (wpantund) on Unix-like operating systems. It can be used along with OpenThread wpantund to provide Internet connectivity to the Thread network.</p>
<div class="section" id="hardware-and-software-setup">
<h2>Hardware and Software Setup<a class="headerlink" href="#hardware-and-software-setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="required-hardware">
<h3>Required Hardware<a class="headerlink" href="#required-hardware" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>2 x <span class="raw-html-m2r"><a href="https://www.synopsys.com/dw/ipdir.php?ds=arc_em_starter_kit" title="DesignWare ARC EM Starter Kit(EMSK)">DesignWare ARC EM Starter Kit(EMSK)</a></span>, recommended version 2.3</p></li>
<li><p>2 x <span class="raw-html-m2r"><a href="http://store.digilentinc.com/pmod-rf2-ieee-802-15-rf-transceiver/" title="Digilent Pmod RF2">Digilent Pmod RF2</a></span></p></li>
<li><p>2 x SD card</p></li>
<li><p>1 x <span class="raw-html-m2r"><a href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b/" title="Raspberry Pi 3">Raspberry Pi 3</a></span> or PC for running <span class="raw-html-m2r"><a href="https://github.com/openthread/wpantund/tree/full/latest-release" title="OpenThread wpantund">OpenThread wpantund</a></span></p></li>
</ul>
</div>
<div class="section" id="required-software">
<h3>Required Software<a class="headerlink" href="#required-software" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Metaware or ARC GNU Toolset</p></li>
<li><p>Serial port terminal, such as putty, tera-term or minicom</p></li>
<li><p><span class="raw-html-m2r"><a href="https://github.com/openthread/wpantund/tree/full/latest-release" title="OpenThread wpantund">OpenThread wpantund</a></span></p></li>
</ul>
</div>
<div class="section" id="hardware-connection">
<h3>Hardware Connection<a class="headerlink" href="#hardware-connection" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Connect PmodRF2 to J6.</p></li>
</ul>
<a class="reference external image-reference" href="doc/screenshots/emsk_connections.jpg"><img alt="EMSK Connections" src="../../../../../_images/emsk_connections1.jpg" /></a>
<ul class="simple">
<li><p>Configure your hardware with proper core configuration. ARCEM7D on EMSK 2.3 is used as an example in the following document.</p></li>
</ul>
</div>
</div>
<div class="section" id="user-manual">
<h2>User Manual<a class="headerlink" href="#user-manual" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="run-openthread-in-self-boot-mode">
<h2>Run OpenThread in self-boot mode<a class="headerlink" href="#run-openthread-in-self-boot-mode" title="Permalink to this headline">¶</a></h2>
<p>Two EMSKs will be used as two Thread nodes, one is CLI Node and the other is NCP Node. They are set automatically by OpenThread stack. The following example is to run the OpenThread CLI and NCP in the EMSK self-boot mode with using SD card.</p>
<ul class="simple">
<li><p>The Digilent PmodRF2 and the self-made MRF24J40 module are both supported.</p></li>
<li><p>Use AC adapter to ensure a steady power supply.</p></li>
<li><p>Open two Tera Term emulators to connect EMSKs with different COM ports.</p></li>
<li><p>The self-boot mode preparation is included in the following steps.</p></li>
<li><p><strong>make run</strong> is not supported because both EMSK board is v2.3 and it will lead to conflict.</p></li>
</ul>
</div>
<div class="section" id="build-and-run-openthread-example">
<h2>Build and Run OpenThread example<a class="headerlink" href="#build-and-run-openthread-example" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Program the secondary bootloader application into onboard SPI Flash.</p>
<ul>
<li><p>Go to <code class="docutils literal notranslate"><span class="pre">\embARC\example\baremetal\bootloader</span></code> in command line.</p></li>
<li><p>Enter <strong>make TOOLCHAIN=gnu BD_VER=23 CUR_CORE=arcem7d bin</strong></p>
<ul class="simple">
<li><p>Select configuration 1 on the EMSK for ARCEM7D by setting all DIP switches to the OFF position.</p></li>
</ul>
</li>
<li><p>Insert the SD card to your PC, and copy the binary file <code class="docutils literal notranslate"><span class="pre">obj_emsk_23/gnu_arcem7d/emsk_bootloader_gnu_arcem7d.bin</span></code> to the SD Card root directory.  Rename it to <code class="docutils literal notranslate"><span class="pre">em7d_2bt.bin</span></code> as the secondary bootloader.</p>
<ul class="simple">
<li><p>The bootloader has been modified in embARC. Please perform the following steps to update the bootloader in the EMSK SPI flash.</p></li>
<li><p>Update the bootloader in both EMSK boards. The other EMSK board should be updated by performing the same steps.</p></li>
</ul>
</li>
<li><p>Connect one EMSK board to the host with USB. Insert the SD Card into the EMSK board SD Card slot.</p>
<ul class="simple">
<li><p>Go to <code class="docutils literal notranslate"><span class="pre">\embARC\example\freertos\net\ntshell</span></code> in command line. Enter <strong>make TOOLCHAIN=gnu BD_VER=23 CUR_CORE=arcem7d</strong>. Once the application builds successfully, enter <strong>make TOOLCHAIN=gnu BD_VER=23 CUR_CORE=arcem7d run</strong> in command line to start NT-Shell.</p></li>
</ul>
</li>
<li><p>Use NT-Shell command <strong>spirw</strong> in the terminal window to write the <code class="docutils literal notranslate"><span class="pre">em7d_2bt.bin</span></code> to SPI flash.</p>
<ul>
<li><p>run <strong>spirw -h</strong> to show help.</p></li>
<li><p>run <strong>spirw -w em7d_2bt.bin 0x17f00000 0x17f00004</strong> to program SPI flash.</p></li>
<li><p>Check the output message to see if it is programmed successfully. The process may take some time. If <code class="docutils literal notranslate"><span class="pre">WF</span> <span class="pre">INIT</span> <span class="pre">FAILED</span></code> and <code class="docutils literal notranslate"><span class="pre">MRF24G</span> <span class="pre">Init</span> <span class="pre">Failed</span></code> is shown in the Tera Term, there is no error since the WiFi module has not been used here.</p>
<a class="reference external image-reference" href="doc/screenshots/spirw_em7d_2bt.jpg"><img alt="spirw_em7d_2bt" src="../../../../../_images/spirw_em7d_2bt1.jpg" /></a>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Generate <code class="docutils literal notranslate"><span class="pre">boot.bin</span></code> of the OpenThread CLI and NCP example.</p>
<ul class="simple">
<li><p>Go to <code class="docutils literal notranslate"><span class="pre">\embARC\example\baremetal\openthread\cli</span></code> and <code class="docutils literal notranslate"><span class="pre">\embARC\example\baremetal\openthread\ncp</span></code> in command line.</p></li>
<li><p>Enter <strong>make TOOLCHAIN=gnu BD_VER=23 CUR_CORE=arcem7d bin</strong>.</p></li>
<li><p>Insert SD Card to PC. Copy the generated binary file <code class="docutils literal notranslate"><span class="pre">obj_emsk_23/gnu_arcem7d/openthread_gnu_arcem7d.bin</span></code> to SD cards root. And rename it to <code class="docutils literal notranslate"><span class="pre">boot.bin</span></code>. Note that the secondary bootloader can only identify <code class="docutils literal notranslate"><span class="pre">boot.bin</span></code> in the SD card root.</p></li>
</ul>
</li>
<li><p>Run OpenThread CLI and NCP example. Before resetting the EMSK boards, make sure Bit 4 of the onboard DIP switch is ON to enable secondary bootloader to run.</p>
<ul>
<li><p>Insert SD Card back to one EMSK. It will run the <strong>CLI</strong> example. Press the reset button to reboot it. Wait for loading boot.bin from SD card. The response in the terminal window is shown as below.</p>
<a class="reference external image-reference" href="doc/screenshots/enter_no_cli_emsk.PNG"><img alt="enter_no_cli_emsk" src="../../../../../_images/enter_no_cli_emsk.PNG" /></a>
</li>
<li><p>Insert the other SD card to the other EMSK. It will run the <strong>NCP</strong> example. Press the reset button to reboot it. Wait for loading boot.bin from SD card.</p>
<a class="reference external image-reference" href="doc/screenshots/enter_no_ncp_emsk.PNG"><img alt="enter_no_ncp_emsk" src="../../../../../_images/enter_no_ncp_emsk.PNG" /></a>
</li>
<li><p>Enter <strong>1</strong> and press Enter button in CLI’s Tera Term. Enter <strong>2</strong> and press Enter button in the NCP’s. Enter the number here to generate pseudo random number for OpenThread. Recommend to enter numbers in order, such as <strong>1</strong>, <strong>2</strong> and <strong>3</strong>. Using same number in different nodes may lead error. The number will not be shown directly in the Tera Term until pressing Enter button from the keyboard.</p></li>
<li><p>After entering <strong>2</strong> in the NCP’s Tera Term, the NCP will start up automatically. It will show you some messy code in the last line, just ignore it. And after that this Tera Term won’t be used any more.</p>
<a class="reference external image-reference" href="doc/screenshots/show_no_emsk.PNG"><img alt="show_no_emsk" src="../../../../../_images/show_no_emsk1.PNG" /></a>
</li>
<li><p>Enter the following commands in the CLI’s Tera Term windows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">panid</span> <span class="mh">0x1234</span>
<span class="o">&gt;</span> <span class="n">ifconfig</span> <span class="n">up</span>
<span class="o">&gt;</span> <span class="n">thread</span> <span class="n">start</span>
</pre></div>
</div>
</li>
<li><p>Wait 20 seconds for completing Thread configuration. Enter “state” to see the state of the node, it will be the <strong>leader</strong>.</p>
<a class="reference external image-reference" href="doc/screenshots/start_cli_emsk.PNG"><img alt="start_cli_emsk" src="../../../../../_images/start_cli_emsk.PNG" /></a>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="install-and-run-openthread-wpantund">
<h2>Install and Run OpenThread wpantund<a class="headerlink" href="#install-and-run-openthread-wpantund" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Download <span class="raw-html-m2r"><a href="https://github.com/openthread/wpantund/tree/full/latest-release" title="OpenThread wpantund">OpenThread wpantund</a></span>. Install wpantund on the Linux host. Here we take the <span class="raw-html-m2r"><a href="https://www.ubuntu.com/download/desktop" title="Ubuntu Desktop 16.04.3 LTS">Ubuntu Desktop 16.04.3 LTS</a></span> for example.</p>
<ul>
<li><p>Install python-software-properties</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install -y python-software-properties
$ sudo add-apt-repository -y ppa:terry.guo/gcc-arm-embedded
$ sudo apt-get update -qq
</pre></div>
</div>
</li>
<li><p>Install packages needed for wpantund build and runtime</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install -y build-essential git make autoconf autoconf-archive automake dbus libtool gcc g++ gperf flex bison texinfo ncurses-dev libexpat-dev python sed python-pip gawk libreadline6-dev libreadline6 libdbus-1-dev libboost-dev
$ sudo apt-get install -y --force-yes gcc-arm-none-eabi
$ sudo pip install pexpect
</pre></div>
</div>
</li>
<li><p>Install <em>wpantund</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd wpantund
$ ./configure --sysconfdir=/etc
$ make
$ sudo make install
</pre></div>
</div>
<p>See <span class="raw-html-m2r"><a href="https://codelabs.developers.google.com/codelabs/openthread-simulation/index.html" title="Simulation Codelab">Simulation Codelab</a></span> for more detailed information.</p>
</li>
</ul>
</li>
<li><p>Connect NCP to the Linux host via USB cable. Type <strong>ls /dev/</strong> to find out which descriptor stands for NCP’s UART interface. Here it is <code class="docutils literal notranslate"><span class="pre">ttyUSB1</span></code>. The communication between NCP and wpantund is based on spinel protocol.</p></li>
<li><p>Run OpenThread wpantund and join the network created by CLI Node.</p>
<ul>
<li><p>Run a terminal and type the following commands to start wpantund:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">wpantund</span> <span class="o">-</span><span class="n">o</span> <span class="n">Config</span><span class="p">:</span><span class="n">NCP</span><span class="p">:</span><span class="n">SocketPath</span> <span class="s2">&quot;/dev/ttyUSB1&quot;</span> <span class="o">-</span><span class="n">o</span> <span class="n">Daemon</span><span class="p">:</span><span class="n">SyslogMask</span> <span class="s2">&quot; -info&quot;</span> <span class="o">-</span><span class="n">o</span> <span class="n">Config</span><span class="p">:</span><span class="n">TUN</span><span class="p">:</span><span class="n">InterfaceName</span> <span class="n">utun6</span>
</pre></div>
</div>
<a class="reference external image-reference" href="doc/screenshots/start_wpantund_pc.png"><img alt="start_wpantund_pc" src="../../../../../_images/start_wpantund_pc.png" /></a>
</li>
<li><p>Run another terminal and type the following commands to enter wpanctl:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">wpanctl</span> <span class="o">-</span><span class="n">I</span> <span class="n">utun6</span>
</pre></div>
</div>
<a class="reference external image-reference" href="doc/screenshots/start_wpanctl_pc.png"><img alt="start_wpanctl_pc" src="../../../../../_images/start_wpanctl_pc.png" /></a>
</li>
<li><p>In the wpanctl, type the following commands to scan and join the Thread network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wpanctl</span><span class="p">:</span><span class="n">utun6</span><span class="o">&gt;</span> <span class="n">scan</span>
<span class="n">wpanctl</span><span class="p">:</span><span class="n">utun6</span><span class="o">&gt;</span> <span class="nb">set</span> <span class="n">Network</span><span class="p">:</span><span class="n">Key</span> <span class="o">--</span><span class="n">data</span> <span class="n">masterkey</span>
<span class="n">wpanctl</span><span class="p">:</span><span class="n">utun6</span><span class="o">&gt;</span> <span class="n">join</span> <span class="mi">1</span>
</pre></div>
</div>
<a class="reference external image-reference" href="doc/screenshots/join_wpanctl_pc.png"><img alt="join_wpanctl_pc" src="../../../../../_images/join_wpanctl_pc.png" /></a>
</li>
<li><p>Run a terminal on PC and type <strong>ifconfig</strong>, it will show you some information about a virtual IPv6 network interface (utun6):</p>
<a class="reference external image-reference" href="doc/screenshots/show_ni_pc.png"><img alt="show_ni_pc" src="../../../../../_images/show_ni_pc.png" /></a>
<p>Note the IPv6 address, here it is <code class="docutils literal notranslate"><span class="pre">fdde:ad00:beef:0:4f6e:7e53:67c8:f5b0</span></code>.</p>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="ping-to-each-other-the-cli-and-linux-host">
<h2>Ping to each other, the CLI and Linux Host<a class="headerlink" href="#ping-to-each-other-the-cli-and-linux-host" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Go to the CLI’s Tera Term. Type <strong>ipaddr</strong> and note it’s IPv6 address, here it is <code class="docutils literal notranslate"><span class="pre">fdde:ad00:beef:0:63a8:7376:c6ad:828c</span></code>. Type <strong>ping fdde:ad00:beef:0:4f6e:7e53:67c8:f5b0</strong>, it will ping the Linux host from CLI:</p>
<a class="reference external image-reference" href="doc/screenshots/ping_pc_from_cli.PNG"><img alt="ping_pc_from_cli" src="../../../../../_images/ping_pc_from_cli.PNG" /></a>
</li>
<li><p>Go to the Linux host, run a terminal and type <strong>ping6 fdde:ad00:beef:0:63a8:7376:c6ad:828c</strong>, it will ping the CLI from Linux host:</p>
<a class="reference external image-reference" href="doc/screenshots/ping_cli_from_pc.png"><img alt="ping_cli_from_pc" src="../../../../../_images/ping_cli_from_pc.png" /></a>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Synopsys
      <span class="lastupdated">
        Last updated on Aug 04, 2021.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>