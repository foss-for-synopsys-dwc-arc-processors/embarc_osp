

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FreeRTOS IoT CoAP Server &mdash; embARC 2019.06 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../_static/style_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
    <link rel="next" title="FreeRTOS IoT LwM2M Client" href="../../lwm2m/lwm2m_client/README.html" />
    <link rel="prev" title="FreeRTOS Demo" href="../../../freertos_blinky/README.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> embARC
          

          
          </a>

          
            
            
              <div class="version">
                2019.06
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../introduction/introduction.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../arc/arc.html">ARC Processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../device/device.html">Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../board/board.html">Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../os/os.html">Operating Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../middleware/middleware.html">Middleware Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../lib/library.html">Libraries</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../example.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../../../example.html#overview">Overview</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../../../example.html">Examples and Demos</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../../../baremetal/baremetal_based_example.html">Baremetal examples</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../../os_based_example.html">OS Based Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../example.html#application-note">Application Note</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../developer/developer_guides.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../faq/faq.html">Usage Guide FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../contribute/contribute.html">Contribute to embARC OSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../changelog/changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../bsp/bsp.html">embARC BSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../license/license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">embARC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../../example.html">Examples</a> &raquo;</li>
        
          <li><a href="../../../../example.html">Examples and Demos</a> &raquo;</li>
        
          <li><a href="../../../os_based_example.html">OS Based Examples</a> &raquo;</li>
        
      <li>FreeRTOS IoT CoAP Server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../../_sources/example/example/freertos/iot/coap/coap_server/README.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="freertos-iot-coap-server">
<span id="example-iot-coap-coap-server"></span><h1>FreeRTOS IoT CoAP Server<a class="headerlink" href="#freertos-iot-coap-server" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>embARC Example for CoAP Protocol on FreeRTOS</p>
</div></blockquote>
<div class="section" id="detailed-description">
<h3>Detailed Description<a class="headerlink" href="#detailed-description" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>Extra Required Tools</dt><dd><p>Python with <a class="reference external" href="https://github.com/Tanganelli/CoAPthon">CoAPthon</a> packet installed</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Extra Required Peripherals</dt><dd><ul>
<li><p>Digilent PMOD WIFI (MRF24WG0MA)</p></li>
<li><p>Digilent PMOD TMP2</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Design Concept</dt><dd><p>This example is designed to show how CoAP server running on FreeRTOS. We prepared three different resources which are helloworld string, temperature readings, and LEDs. To demonstrate the function of CoAP server, we need to use CoAPthon as a CoAP client.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Usage Manual</dt><dd><p>This is an example running coap server on LwIP with FreeRTOS. The Pmod modules should be connected to ARC board.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Extra Comments</dt><dd><p>NO</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="building-and-running">
<h2>Building and Running<a class="headerlink" href="#building-and-running" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>This example outputs to the console. It is supported by all platform. You might need to change MUX configurations or connect wires in order to use peripheral modules, see <a class="reference internal" href="../../../../../../getting_started/peripheral_preparation.html#peripheral-preparation"><span class="std std-ref">Peripheral Preparation</span></a>.
The commands to run this example are as follows:</p>
</div></blockquote>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> &lt;embarc_root&gt;/example/freertos/iot/coap/coap_server
<span class="gp">$</span> make <span class="nv">BOARD</span><span class="o">=</span>emsk <span class="nv">BD_VER</span><span class="o">=</span><span class="m">22</span> <span class="nv">CUR_CORE</span><span class="o">=</span>arcem7d <span class="nv">TOOLCHAIN</span><span class="o">=</span>gnu run
</pre></div>
</div>
<p>When the WiFi is connected and CoAP server is running, you may run python code shown below.
The python code uses CoAPthon packet as a CoAP Client and try to get and post resources from server. Please noted that the host IP in python code should be replaced to the ipaddr shown on board uart console before running.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">coapthon.client.helperclient</span> <span class="kn">import</span> <span class="n">HelperClient</span>
<span class="n">host</span> <span class="o">=</span> <span class="s2">&quot;192.168.137.65&quot;</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">5683</span>
<span class="n">path</span> <span class="o">=</span><span class="s2">&quot;hello&quot;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">HelperClient</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">())</span>

<span class="n">path</span> <span class="o">=</span><span class="s2">&quot;temperature&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">())</span>

<span class="n">path</span> <span class="o">=</span><span class="s2">&quot;leds&quot;</span>
<span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;0xAA&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">())</span>

<span class="n">client</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
<p>You may save this code as a .py file (e.g. <code class="docutils literal notranslate"><span class="pre">CoAP_client.py</span></code>) and run it from a new cmd console. Here is an example of running the python code at a new cmd console:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> &lt;py_file_location&gt;
<span class="gp">$</span> CoAP_client.py
</pre></div>
</div>
<div class="section" id="sample-output">
<h3>Sample Output<a class="headerlink" href="#sample-output" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Output from embARC</p>
</div></blockquote>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">-----------------------------------------------------------</span>
<span class="go"> ____                                _ ____</span>
<span class="go">|  _ \ _____      _____ _ __ ___  __| | __ ) _   _</span>
<span class="go">| |_) / _ \ \ /\ / / _ \ &#39;__/ _ \/ _` |  _ \| | | |</span>
<span class="go">|  __/ (_) \ V  V /  __/ | |  __/ (_| | |_) | |_| |</span>
<span class="go">|_|   \___/ \_/\_/ \___|_|  \___|\__,_|____/ \__, |</span>
<span class="go">                                             |___/</span>
<span class="go">                     _       _    ____   ____</span>
<span class="go">       ___ _ __ ___ | |__   / \  |  _ \ / ___|</span>
<span class="go">      / _ \ &#39;_ ` _ \| &#39;_ \ / _ \ | |_) | |</span>
<span class="go">     |  __/ | | | | | |_) / ___ \|  _ &lt;| |___</span>
<span class="go">      \___|_| |_| |_|_.__/_/   \_\_| \_\\____|</span>
<span class="go">------------------------------------------------------------</span>

<span class="go">embARC Build Time: Apr 13 2018, 10:08:43</span>
<span class="go">Compiler Version: Metaware, 4.2.1 Compatible Clang 4.0.1 (branches/release_40)</span>
<span class="go">Start Init LWIP</span>
<span class="go">Enter to main function....</span>
<span class="go">Wait until WiFi connected...</span>

<span class="go">Now trying to connect to WIFI hotspot, please wait about 30s!</span>
<span class="go">MRF24G Device Information As Follows:</span>
<span class="go">Device Type:2, ROM Ver:31, Patch Ver:7</span>
<span class="go">Connection Profile ID:1</span>
<span class="go">WF INIT SUCCESSFULL!</span>
<span class="go">MRF24G MAC ADDRESS:00-1e-c0-0e-6e-0a</span>
<span class="go">WF_EVENT_CONNECTION_SUCCESSFUL</span>
<span class="go">Link is UP!</span>

<span class="go">Now start get ip address using DHCP, Please wait about 30s!</span>

<span class="go">-----PMOD WIFI IP ADDRESS INFO-----</span>
<span class="go"> ipaddr 192.168.137.65 netmask 255.255.255.0 gw 192.168.137.1</span>
<span class="go"> dns server 0 :192.168.137.1</span>
<span class="go"> dns server 1 :0.0.0.0</span>
<span class="go">-----------------------------------</span>
<span class="go">WiFi connected</span>
<span class="go">temperature update running</span>
<span class="go">Exit from main function, error code:0....</span>
</pre></div>
</div>
<p>Output from CoAPthon CoAP client</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">2018-04-13 10:10:35,208 - MainThread - coapthon.layers.messagelayer - DEBUG - send_request - From None, To (&#39;192.168.137.65&#39;, 5683), None-None, GET-bG, [Uri-Path: hello, ] No payload</span>
<span class="go">2018-04-13 10:10:35,208 - MainThread - coapthon.client.coap - DEBUG - send_datagram - From None, To (&#39;192.168.137.65&#39;, 5683), CON-10095, GET-bG, [Uri-Path: hello, ] No payload</span>
<span class="go">2018-04-13 10:10:35,209 - Thread-1   - coapthon.client.coap - DEBUG - Start receiver Thread</span>
<span class="go">2018-04-13 10:10:35,210 - MainThread-Retry-10095 - coapthon.client.coap - DEBUG - retransmit loop ... enter</span>
<span class="go">2018-04-13 10:10:35,385 - Thread-1   - coapthon.client.coap - DEBUG - receive_datagram - From (&#39;192.168.137.65&#39;, 5683), To None, ACK-10095, CONTENT-bG, [Content-Type: 0, Max-Age: 196607, ] hello world...11 bytes</span>
<span class="go">2018-04-13 10:10:35,386 - Thread-1   - coapthon.layers.messagelayer - DEBUG - receive_response - From (&#39;192.168.137.65&#39;, 5683), To None, ACK-10095, CONTENT-bG, [Content-Type: 0, Max-Age: 196607, ] hello world...11 bytes</span>
<span class="go">2018-04-13 10:10:35,386 - Thread-1   - coapthon.client.coap - DEBUG - Waiting for retransmit thread to finish ...</span>
<span class="go">2018-04-13 10:10:35,387 - MainThread-Retry-10095 - coapthon.client.coap - DEBUG - retransmit loop ... exit</span>
<span class="go">Source: (&#39;192.168.137.65&#39;, 5683)</span>
<span class="go">Destination: None</span>
<span class="go">Type: ACK</span>
<span class="go">MID: 10095</span>
<span class="go">Code: CONTENT</span>
<span class="go">Token: bG</span>
<span class="go">Content-Type: 0</span>
<span class="go">Max-Age: 196607</span>
<span class="go">Payload:</span>
<span class="go">hello world</span>

<span class="go">2018-04-13 10:10:35,401 - MainThread - coapthon.layers.messagelayer - DEBUG - send_request - From None, To (&#39;192.168.137.65&#39;, 5683), None-None, GET-VK, [Uri-Path: temperature, ] No payload</span>
<span class="go">2018-04-13 10:10:35,402 - MainThread - coapthon.client.coap - DEBUG - send_datagram - From None, To (&#39;192.168.137.65&#39;, 5683), CON-10096, GET-VK, [Uri-Path: temperature, ] No payload</span>
<span class="go">2018-04-13 10:10:35,406 - MainThread-Retry-10096 - coapthon.client.coap - DEBUG - retransmit loop ... enter</span>
<span class="go">2018-04-13 10:10:35,553 - Thread-1   - coapthon.client.coap - DEBUG - receive_datagram - From (&#39;192.168.137.65&#39;, 5683), To None, ACK-10096, CONTENT-VK, [Content-Type: 0, Max-Age: 60, ] 28.187500...9 bytes</span>
<span class="go">2018-04-13 10:10:35,554 - Thread-1   - coapthon.layers.messagelayer - DEBUG - receive_response - From (&#39;192.168.137.65&#39;, 5683), To None, ACK-10096, CONTENT-VK, [Content-Type: 0, Max-Age: 60, ] 28.187500...9 bytes</span>
<span class="go">2018-04-13 10:10:35,557 - Thread-1   - coapthon.client.coap - DEBUG - Waiting for retransmit thread to finish ...</span>
<span class="go">2018-04-13 10:10:35,557 - MainThread-Retry-10096 - coapthon.client.coap - DEBUG - retransmit loop ... exit</span>
<span class="go">Source: (&#39;192.168.137.65&#39;, 5683)</span>
<span class="go">Destination: None</span>
<span class="go">Type: ACK</span>
<span class="go">MID: 10096</span>
<span class="go">Code: CONTENT</span>
<span class="go">Token: VK</span>
<span class="go">Content-Type: 0</span>
<span class="go">Max-Age: 60</span>
<span class="go">Payload:</span>
<span class="go">28.187500</span>

<span class="go">2018-04-13 10:10:35,572 - MainThread - coapthon.layers.messagelayer - DEBUG - send_request - From None, To (&#39;192.168.137.65&#39;, 5683), None-None, POST-wR, [Uri-Path: leds, ] 0xAA...4 bytes</span>
<span class="go">2018-04-13 10:10:35,573 - MainThread - coapthon.client.coap - DEBUG - send_datagram - From None, To (&#39;192.168.137.65&#39;, 5683), CON-10097, POST-wR, [Uri-Path: leds, ] 0xAA...4 bytes</span>
<span class="go">2018-04-13 10:10:35,577 - MainThread-Retry-10097 - coapthon.client.coap - DEBUG - retransmit loop ... enter</span>
<span class="go">2018-04-13 10:10:35,655 - Thread-1   - coapthon.client.coap - DEBUG - receive_datagram - From (&#39;192.168.137.65&#39;, 5683), To None, ACK-10097, CONTENT-wR, [] No payload</span>
<span class="go">2018-04-13 10:10:35,656 - Thread-1   - coapthon.layers.messagelayer - DEBUG - receive_response - From (&#39;192.168.137.65&#39;, 5683), To None, ACK-10097, CONTENT-wR, [] No payload</span>
<span class="go">2018-04-13 10:10:35,659 - Thread-1   - coapthon.client.coap - DEBUG - Waiting for retransmit thread to finish ...</span>
<span class="go">2018-04-13 10:10:35,659 - MainThread-Retry-10097 - coapthon.client.coap - DEBUG - retransmit loop ... exit</span>
<span class="go">Source: (&#39;192.168.137.65&#39;, 5683)</span>
<span class="go">Destination: None</span>
<span class="go">Type: ACK</span>
<span class="go">MID: 10097</span>
<span class="go">Code: CONTENT</span>
<span class="go">Token: wR</span>
<span class="go">Payload:</span>
<span class="go">None</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../lwm2m/lwm2m_client/README.html" class="btn btn-neutral float-right" title="FreeRTOS IoT LwM2M Client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../../freertos_blinky/README.html" class="btn btn-neutral float-left" title="FreeRTOS Demo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Synopsys

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>