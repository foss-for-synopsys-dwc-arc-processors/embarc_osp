<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>embARC: embARC Bootloader Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 50px;">
  <td id="projectlogo"><img alt="Logo" src="embARC_Logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectnumber">2017.03</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">embARC Bootloader Example<div class="ingroups"><a class="el" href="group___e_m_b_a_r_c___a_p_p_s.html">embARC Applications</a> &raquo; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___t_o_t_a_l.html">All embARC Applications</a><a class="el" href="group___e_m_b_a_r_c___a_p_p_s.html">embARC Applications</a> &raquo; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___o_s.html">embARC Applications for Different Operating Systems</a> &raquo;  &#124; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___b_a_r_e_m_e_t_a_l.html">embARC Baremetal Applications</a><a class="el" href="group___e_m_b_a_r_c___a_p_p_s.html">embARC Applications</a> &raquo; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___m_i_d.html">embARC Applications for Different Middlewares</a> &raquo;  &#124; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___m_i_d___n_t_s_h_e_l_l.html">embARC NTShell Applications</a><a class="el" href="group___e_m_b_a_r_c___a_p_p_s.html">embARC Applications</a> &raquo; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___m_i_d.html">embARC Applications for Different Middlewares</a> &raquo;  &#124; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___m_i_d___f_a_t_f_s.html">embARC FatFS Applications</a><a class="el" href="group___e_m_b_a_r_c___a_p_p_s.html">embARC Applications</a> &raquo; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___m_i_d.html">embARC Applications for Different Middlewares</a> &raquo;  &#124; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___m_i_d___p_a_r_s_o_n.html">embARC Parson Applications</a><a class="el" href="group___e_m_b_a_r_c___a_p_p_s.html">embARC Applications</a> &raquo; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___m_i_d.html">embARC Applications for Different Middlewares</a> &raquo;  &#124; <a class="el" href="group___e_m_b_a_r_c___a_p_p_s___m_i_d___i_h_e_x.html">embARC iHex Applications</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>embARC example for secondary bootloader  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:example_2baremetal_2bootloader_2main_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="example_2baremetal_2bootloader_2main_8c.html">example/baremetal/bootloader/main.c</a></td></tr>
<tr class="memdesc:example_2baremetal_2bootloader_2main_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">example of secondary bootloader after the bootrom of EMSK <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwifi__cfg__t.html">wifi_cfg_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structboot__cfg__t.html">boot_cfg_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga3bc9bc7984876d90e33dd8147fd55831"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga3bc9bc7984876d90e33dd8147fd55831"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>BOOT_CFG_FILE_NAME</b>&#160;&#160;&#160;&quot;boot.json&quot;</td></tr>
<tr class="separator:ga3bc9bc7984876d90e33dd8147fd55831"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga08ad705eea015654280c15259a7832ce"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r.html#ga08ad705eea015654280c15259a7832ce">BOOT_FILE_NAME</a>&#160;&#160;&#160;&quot;0:\\boot.bin&quot;</td></tr>
<tr class="separator:ga08ad705eea015654280c15259a7832ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga16b17011a83b5823d6d0caa900eb358f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r.html#ga16b17011a83b5823d6d0caa900eb358f">RAM_STARTADDRESS</a>&#160;&#160;&#160;0x10000000</td></tr>
<tr class="separator:ga16b17011a83b5823d6d0caa900eb358f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga55d7be649325d97ae16ea0dfaaeeabd3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r.html#ga55d7be649325d97ae16ea0dfaaeeabd3">APP_CFG_ADDR</a>&#160;&#160;&#160;0x17f00000</td></tr>
<tr class="separator:ga55d7be649325d97ae16ea0dfaaeeabd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga31ec62b4b49f985c75b6c503091fc97d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r.html#ga31ec62b4b49f985c75b6c503091fc97d">PROMT_DELAY_S</a>&#160;&#160;&#160;(5)</td></tr>
<tr class="separator:ga31ec62b4b49f985c75b6c503091fc97d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gae906ae2cf2480e1a1794710c0ac1e8b4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gae906ae2cf2480e1a1794710c0ac1e8b4"></a>
typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><b>fp_t</b> )(void)</td></tr>
<tr class="separator:gae906ae2cf2480e1a1794710c0ac1e8b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga840291bc02cba5474a4cb46a9b9566fe"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r.html#ga840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="memdesc:ga840291bc02cba5474a4cb46a9b9566fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">test bootloader <br /></td></tr>
<tr class="separator:ga840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga9ff00a8f37c09ae257b02a84ae5b8180"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga9ff00a8f37c09ae257b02a84ae5b8180"></a>
struct <a class="el" href="structwifi__cfg__t.html">wifi_cfg_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>wifi_cfg</b></td></tr>
<tr class="separator:ga9ff00a8f37c09ae257b02a84ae5b8180"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad1bde54810c5cd89642e80409f24f241"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structboot__cfg__t.html">boot_cfg_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>boot_cfg</b></td></tr>
<tr class="separator:gad1bde54810c5cd89642e80409f24f241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5352237647c29bdd7ce3c09170d1594b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga5352237647c29bdd7ce3c09170d1594b"></a>
static NTSHELL_IO *&#160;</td><td class="memItemRight" valign="bottom"><b>nt_io</b></td></tr>
<tr class="separator:ga5352237647c29bdd7ce3c09170d1594b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga296b3c88b34a2294d0bd990ac963543b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga296b3c88b34a2294d0bd990ac963543b"></a>
static FIL&#160;</td><td class="memItemRight" valign="bottom"><b>file</b></td></tr>
<tr class="separator:ga296b3c88b34a2294d0bd990ac963543b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>embARC example for secondary bootloader </p>
<h3>Extra Required Tools</h3>
<h3>Extra Required Peripherals</h3>
<ul>
<li>SDCard with boot binary(boot.hex or boot.bin)</li>
</ul>
<h3>Design Concept</h3>
<p>This example is designed to work as a secondary bootloader for embARC, it will load boot.hex or boot.bin on SDCard and run that program.</p>
<h3>Usage Manual</h3>
<p>As shown in the following picture, when the EMSK configuration in SPI flash is loaded into the FPGA, a simple primary bootloader is also loaded in ICCM. Through the primary bootloader, the application or secondary bootloader can be loaded into external memory (DDR memory), bootloader start address is 0x17F00004, ram address is 0x17F00000.</p>
<p>For EMSK1.x, bootloader core configuration must be arcem6, for EMSK2.x, bootloader core configuration must be arcem7d. For EMSK 1.0, it can be upgraded to 1.1 by 1.1's firmware. For EMSK 2.0/2.1/2.2, it can be upgraded to 2.3 by 2.3's firmware.</p>
<p> 
    <div class="imagebox">
        <div style="width: 500px">
            <img src="pic/bootloader.jpg" alt="Secondary Bootloader"/>
            <p>Secondary Bootloader</p>
        </div>
    </div>
    </p>
<p>Here are steps for how to program the secondary bootloader application into onboard SPIFlash(Take EMSK2.3 - ARC EM7D as example) and automatically load and run <em>boot.hex</em> or <em>boot.bin</em> in SDCard.</p><ul>
<li>Generate a secondary bootloader binary file<ul>
<li>cd &lt;embARC&gt;/example/baremetal/bootloader</li>
<li>Generate binary file: make TOOLCHAIN=gnu BD_VER=23 CUR_CORE=arcem7d bin<ul>
<li>If the binary file is generated successfully, you will output as follows: <div class="fragment"><div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../middleware/ntshell/cmds/cmds_fs/ymodem/ymodemio.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../middleware/ntshell/port/ntshell_usrcmd.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../middleware/ntshell/port/ntshell_task.c</div>
<div class="line"><span class="stringliteral">&quot;Archiving             : &quot;</span> obj_emsk_23/gnu_arcem7d/libmidntshell.a</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../middleware/parson/parson.c</div>
<div class="line"><span class="stringliteral">&quot;Archiving             : &quot;</span> obj_emsk_23/gnu_arcem7d/libmidparson.a</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../arc/arc_timer.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../arc/arc_cache.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../arc/arc_exception.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../arc/arc_udma.c</div>
<div class="line"><span class="stringliteral">&quot;Assembling            : &quot;</span> ../../../arc/arc_exc_asm.s</div>
<div class="line"><span class="stringliteral">&quot;Archiving             : &quot;</span> obj_emsk_23/gnu_arcem7d/libcpuarc.a</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../library/clib/fatfs_dirent.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../library/clib/malloc.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../library/clib/embARC_sbrk.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../library/clib/embARC_misc.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../library/clib/embARC_syscalls.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../library/clib/ya_getopt.c</div>
<div class="line"><span class="stringliteral">&quot;Compiling             : &quot;</span> ../../../library/clib/embARC_target.c</div>
<div class="line"><span class="stringliteral">&quot;Archiving             : &quot;</span> obj_emsk_23/gnu_arcem7d/liblibclib.a</div>
<div class="line"><span class="stringliteral">&quot;Archiving             : &quot;</span> obj_emsk_23/gnu_arcem7d/libembarc.a</div>
<div class="line"><span class="stringliteral">&quot;Linking               : &quot;</span> obj_emsk_23/gnu_arcem7d/emsk_bootloader_gnu_arcem7d.elf</div>
<div class="line"><span class="stringliteral">&quot;Generating Binary obj_emsk_23/gnu_arcem7d/emsk_bootloader_gnu_arcem7d.bin&quot;</span></div>
</div><!-- fragment --></li>
</ul>
</li>
</ul>
</li>
<li>Program generated secondary bootloader binary file into SPIFlash<ul>
<li>Insert SDCard to your PC, and copy the binary file <em>obj_emsk_23/gnu_arcem7d/emsk_bootloader_gnu_arcem7d.bin</em> to SDCard Root, and rename it to <em>em7d_2bt.bin</em></li>
<li>Insert the SDCard to EMSK Board, and build and run the <em>&lt;embARC&gt;/example/baremetal/bootloader</em> example, please choose the right core configuration</li>
<li>Then use ntshell command <em>spirw</em> to program the <em>em7d_2bt.bin</em> into spiflash.<ul>
<li>Firstly, run <em>spirw</em> to show help</li>
<li>Secondly, run <em>spirw -i</em> to check SPIFlash ID, it should be <b>Device ID = ef4018</b></li>
<li>Thirdly, run <em>spirw -w em7d_2bt.bin 0x17f00000 0x17f00004</em> to program spiflash</li>
<li>Check the output message to see if if was programmed successfully.</li>
<li><div class="image">
<img src="emsk_bootloader_program2splflash.jpg" alt="emsk_bootloader_program2splflash.jpg"/>
<div class="caption">
ScreenShot of program secondary bootloader to spiflash</div></div>
</li>
</ul>
</li>
<li>If programmed successfully, when the board is reset, make sure Bit 4 of the onboard DIP switch is ON to enable secondary bootloader run. <div class="image">
<img src="emsk_bootloader_onspiflash.jpg" alt="emsk_bootloader_onspiflash.jpg"/>
<div class="caption">
ScreenShot of secondary bootloader autoboot when board configuration is reloaded</div></div>
</li>
</ul>
</li>
<li>Generate <em>boot.bin</em> using any embARC example which ram start address should be 0x10000000 and use bootloader to run it<ul>
<li>Here take <em>&lt;embARC&gt;/example/freertos/kernel</em> for example</li>
<li>cd &lt;embARC&gt;/example/freertos/kernel</li>
<li>Build and generate binary file: <em>make TOOLCHAIN=gnu BD_VER=23 CUR_CORE=arcem7d bin</em></li>
<li>Insert SDCard to PC, and copy generated binary file <em>obj_emsk_23/gnu_arcem7d/freertos_kernel_gnu_arcem7d.bin</em> to SDCard Root, and rename it to boot.bin</li>
<li>Insert SDCard back to EMSK, make sure bit 4 of DIP Switch is ON, and press re-configure button above letter <b>C</b>, and wait for autoload.</li>
<li><div class="image">
<img src="emsk_bootloader_loadbootbin.jpg" alt="emsk_bootloader_loadbootbin.jpg"/>
<div class="caption">
ScreenShot of secondary bootloader auto load boot.bin</div></div>
</li>
</ul>
</li>
<li>Know Issues<ul>
<li>Bootrom of EMSK1.x is not able to load secondary bootloader on SPIFlash, you need a modified EMSK1.x mcs file to enable this function, please send request in forum about this mcs file.</li>
</ul>
</li>
</ul>
<p><b>The secondary bootloader is a complement of the primary bootloader, and provides the following functions:</b></p><ul>
<li>File operations on SD card</li>
<li>Operations on the EMSK, GPIO, I2C, SPI flash</li>
<li>Operations on ARC processors</li>
<li>Automatic boot from SD card, using following instructions:<ul>
<li>burn the bin file of bootloader into EMSK spi flash using spirw command <b>spirw -w bootloader.bin 0x17f00000 0x17f00004 </b> with the help of JTAG</li>
<li>the primary bootloader should be able to load the secondary bootloader</li>
<li>put the file you want to boot in the root directory of SD card, name it boot.bin</li>
<li>plug in SD card</li>
</ul>
</li>
<li>LED Status of loading application(boot.bin)<ul>
<li>Start to load application: LED on board -&gt; 0x0F</li>
<li>Load application finished: LED on board -&gt; 0xFF, if application is running normally, LED will quickly change to 0x0</li>
<li>Load application failed: LED on board -&gt; 0xAA</li>
<li>Skip loading application, and enter to NTShell runtime: LED on board -&gt; 0x0</li>
</ul>
</li>
<li>Type <em>help</em> command in ntshell to show the list of supported commands.</li>
</ul>
<div class="image">
<img src="emsk_bootloader.jpg" alt="emsk_bootloader.jpg"/>
<div class="caption">
ScreenShot of bootloader under baremetal</div></div>
 <h3>Extra Comments</h3>
<ul>
<li>Bootrom of EMSK1.x is not able to load secondary bootloader on SPIFlash, you need a modified EMSK1.x mcs file to enable this function, please send request in forum about this mcs file.</li>
<li>Make sure that the bootloader can only load application for extract the same core you built for.</li>
<li>Bootloader example only support arc core configuration which has DDR with cache enabled.</li>
<li>Bootloader example runs in DDR ram, not in CCM.</li>
<li>Bootloader example itself can be treated as a ntshell example, you can run some ntshell commands using this example.</li>
<li>Supported core configurations<ul>
<li>EMSK 1.1: EM6, EM6GP</li>
<li>EMSK 2.2/2.3: EM7D, EM11D </li>
</ul>
</li>
</ul>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga55d7be649325d97ae16ea0dfaaeeabd3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APP_CFG_ADDR&#160;&#160;&#160;0x17f00000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>save the app configuration file name </p>

<p>Definition at line <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html#l00172">172</a> of file <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html">example/baremetal/bootloader/main.c</a>.</p>

<p>Referenced by <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html#l00211">main()</a>.</p>

</div>
</div>
<a class="anchor" id="ga08ad705eea015654280c15259a7832ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BOOT_FILE_NAME&#160;&#160;&#160;&quot;0:\\boot.bin&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>default autoload full file name </p>

<p>Definition at line <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html#l00170">170</a> of file <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html">example/baremetal/bootloader/main.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga31ec62b4b49f985c75b6c503091fc97d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PROMT_DELAY_S&#160;&#160;&#160;(5)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>default wait time for autoload </p>

<p>Definition at line <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html#l00173">173</a> of file <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html">example/baremetal/bootloader/main.c</a>.</p>

<p>Referenced by <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html#l00211">main()</a>.</p>

</div>
</div>
<a class="anchor" id="ga16b17011a83b5823d6d0caa900eb358f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RAM_STARTADDRESS&#160;&#160;&#160;0x10000000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>default ram start address of boot.bin </p>

<p>Definition at line <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html#l00171">171</a> of file <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html">example/baremetal/bootloader/main.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="gad1bde54810c5cd89642e80409f24f241"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structboot__cfg__t.html">boot_cfg_t</a> boot_cfg</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">        .ntshell = 0,</div>
<div class="line">        .boot_file = <a class="code" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r.html#ga08ad705eea015654280c15259a7832ce">BOOT_FILE_NAME</a>,</div>
<div class="line">        .ram_startaddress = <a class="code" href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r.html#ga16b17011a83b5823d6d0caa900eb358f">RAM_STARTADDRESS</a>,</div>
<div class="line">}</div>
<div class="ttc" id="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r_html_ga16b17011a83b5823d6d0caa900eb358f"><div class="ttname"><a href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r.html#ga16b17011a83b5823d6d0caa900eb358f">RAM_STARTADDRESS</a></div><div class="ttdeci">#define RAM_STARTADDRESS</div><div class="ttdef"><b>Definition:</b> <a href="example_2baremetal_2bootloader_2main_8c_source.html#l00171">example/baremetal/bootloader/main.c:171</a></div></div>
<div class="ttc" id="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r_html_ga08ad705eea015654280c15259a7832ce"><div class="ttname"><a href="group___e_m_b_a_r_c___a_p_p___b_a_r_e_m_e_t_a_l___b_o_o_t_l_o_a_d_e_r.html#ga08ad705eea015654280c15259a7832ce">BOOT_FILE_NAME</a></div><div class="ttdeci">#define BOOT_FILE_NAME</div><div class="ttdef"><b>Definition:</b> <a href="example_2baremetal_2bootloader_2main_8c_source.html#l00170">example/baremetal/bootloader/main.c:170</a></div></div>
</div><!-- fragment -->
<p>Definition at line <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html#l00198">198</a> of file <a class="el" href="example_2baremetal_2bootloader_2main_8c_source.html">example/baremetal/bootloader/main.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Mar 24 2017 15:51:39 for embARC by
    <a href="http://www.synopsys.com">
    <img class="footer" src="pic/snps_logo.png" alt="snps_logo"/></a>. All Rights Reserved. </li>
  </ul>
</div>
</body>
</html>
